<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recetísimas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <div class="container py-5">
    <h1 class="mb-4 text-center">Recetísimas</h1>

    <div id="contenedor-recetas" class="row g-4">
      <!-- Aquí se insertarán las tarjetas -->
    </div>
  </div>

 <script type="module" src="js/main.js"> </script>

  <script>
    const API_URL = 'http://localhost:3000/api/recetas';
  fetch(API_URL)
    .then(response => response.json())
    .then(data => {
      const contenedor = document.getElementById('contenedor-recetas');

      if (data.length === 0) {
        contenedor.innerHTML = '<p class="text-center">No hay recetas disponibles.</p>';
        return;
      }
      // itera sobre cada receta, creando una si las hay
      data.forEach(receta => {
        const card = document.createElement('div');
        card.className = 'col-md-4';

        card.innerHTML = `
          <div class="card shadow-sm h-100">
            <img src="http://localhost:3000/images/${receta.imagen || 'default.jpg'}" class="card-img-top" alt="${receta.nombre}">
            <div class="card-body">
              <h5 class="card-title">${receta.nombre}</h5>
              <p class="card-text">${receta.descripcion}</p>
            </div>
            <div class="card-body d-flex justify-content-between">
              <a href="detalle_receta.html?id=${receta.id}" class="card-link text-primary">Ver receta</a>
              <a href="agregar_receta.html?id=${receta.id}" class="card-link text-warning">Editar</a>
              <a href="#" class="card-link text-danger" onclick="eliminarReceta(${receta.id})">Eliminar</a>
            </div>
          </div>
        `;

        contenedor.appendChild(card);
      });
    })
    //manejo de errores durante el fetch a la API
    .catch(error => {
      console.error('Error al obtener recetas:', error);
      document.getElementById('contenedor-recetas').innerHTML =
        '<p class="text-danger">Error al cargar las recetas. Intenta más tarde.</p>';
    });

  function eliminarReceta(id) {
    if (confirm("¿Estás seguro de eliminar esta receta?")) {
      fetch(`http://localhost:3000/api/recetas/${id}`, {
        method: 'DELETE'
      }).then(response => {
        if (response.ok) {
          alert("Receta eliminada");
          location.reload();
        } else {
          alert("Error al eliminar la receta");
        }
      });
    }
  }
  </script>
</body>
</html>
